<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script>
         function byId(id) {
            return document.getElementById(id).value;
        }

        function convertiranumtrasformaciones(arreglo, lim) {

            var arrs = arreglo.split(lim);
            arrn =[];
            var v = arrs[0].split(" ")
            arrs[0]= v[1]
            arrs.forEach((elem) => {
                arrn.push(Number(elem))
            });
            arrn[3]=v[0]
            return arrn;
        }

        function convertiranum(arreglo, lim) {
            var arrs = arreglo.split(lim);
            arrn =[];
            arrs.forEach((elem) => {
                arrn.push(Number(elem))
            });
            return arrn;
        }

        function convertiraradianes(arreglo){
            var radianes =[];
            for(var i =0;i<3; i++){
                radianes[i]=arreglo[i]*(Math.PI / 180);
            }
            return radianes
        }

        function suma(array1, vector) {
            return array1.map(function(num, idx){
                return num + vector[idx]
            });
        }

        function multiplicar(array1, vector){
            return array1.map(function(num, idx){
                return num * vector[idx]
            });
        }

        function rotar(array1,angulo)
        {
            var rad=convertiraradianes(angulo)
            var arr2 = [];
            // T/-1*rx/-1(a)*ry/-1(b)*rz(c)*ry(b*rx(a))
            //rotar en z
            arr2[0] = (array1[0] * Math.cos(rad[2]) - array1[1] * Math.sin(rad[2])).toFixed(2);
            arr2[1] = (array1[0] * Math.sin(rad[2]) + array1[1] * Math.cos(rad[2])).toFixed(2);
            arr2[2]= array1[2];
            //rotar en y 
            var arr1 = [];
            arr1[0] = (array1[0] * Math.cos(rad[1]) + array1[2] * Math.sin(rad[1])).toFixed(2);
            arr1[2] = (array1[2] * Math.cos(rad[1]) - array1[0] * Math.sin(rad[1])).toFixed(2);
            arr1[1]= array1[1];
            //rotar en x 
            var arr0 = [];
            arr1[0] = (array1[0] * Math.cos(rad[0]) + array1[2] * Math.sin(rad[0])).toFixed(2);
            arr1[2] = (array1[2] * Math.cos(rad[0]) - array1[0] * Math.sin(rad[0])).toFixed(2);
            arr1[1]= array1[1];

            return arr2;
        }


        function procesar(){
            punto1 = convertiranum(byId("p1"), ",")
            punto2 = convertiranum(byId("p2"), ",")
            transformacionInicial = convertiranumtrasformaciones(byId("ti"), ",")
            transformacionFinal = convertiranumtrasformaciones(byId("tf"), ",")
            if(transformacionInicial[3]=="R"){
                punto1 = rotar(punto1,transformacionInicial)
                punto2 = rotar(punto2,transformacionInicial)
            }if(transformacionInicial[3]=="S") {
                punto1 = multiplicar(punto1,transformacionInicial)
                punto2 = multiplicar(punto2,transformacionInicial)
            }if(transformacionInicial[3]=="T") {
                punto1 = suma(punto1,transformacionInicial)
                punto2 = suma(punto2,transformacionInicial)
            }else{
                alert("ingresa una letra valida : T, S, R")
            }
            if(transformacionFinal[3]=="R"){
                punto1 = rotar(punto1,transformacionFinal)
                punto2 = rotar(punto2,transformacionFinal)
            }if(transformacionFinal[3]=="S") {
                punto1 = multiplicar(punto1,transformacionFinal)
                punto2 = multiplicar(punto2,transformacionFinal)
            }if(transformacionFinal[3]=="T") {
                punto1 = suma(punto1,transformacionFinal)
                punto2 = suma(punto2,transformacionFinal)
            }else{
                alert("ingresa una letra valida : T, S, R")
            }
            document.getElementById("rp1").value =punto1;
            document.getElementById("rp2").value =punto2;
        }



    </script>
</head>
<body>
    <h1> Transformaciones conjuntas</h1>
    <p> vector para la transformacion => p1, 
        <input id="p1" size="10"> ,p2,  <input id="p2" size="10"> 
    </p>
    <p> Transformacion inicial
        <input id="ti" size="10"> 
    </p>
    <p> Transformacion final
        <input id="tf" size="10"> 
    </p>
    <p> vector resultado p1,  
        <input id="rp1" size="10"> , p2,  <input id="rp2" size="10">  
    </p>
    <button id="btn" onclick="procesar()">procesar</button></p>

</body>
</html>